# Cinema Booking Frontend

Веб-приложение для бронирования билетов в кинотеатр, разработанное на Vue 3 с TypeScript.

## Технологический стек

- **Vue 3** (Composition API)
- **TypeScript**
- **Vite** - сборщик и dev-сервер
- **Vue Router** - маршрутизация
- **Pinia** - управление состоянием
- **axios** - HTTP клиент
- **Vitest** - тестирование

## Быстрый старт

### 1. Установка зависимостей

Сначала установите зависимости для фронтенда:

```bash
npm install
```

Затем установите зависимости для бэкенда:

```bash
cd backend
npm install
cd ..
```

Или используйте скрипт подготовки (автоматически клонирует и устанавливает бэкенд):

```bash
npm run prepare
```

### 2. Запуск приложения

Приложение состоит из двух частей: бэкенд (API) и фронтенд (Vue приложение).

**Запуск бэкенда:**

В отдельном терминале:

```bash
cd backend
npm start
```

Бэкенд будет доступен на `http://localhost:3022`
- API документация (Swagger): `http://localhost:3022/api-docs`

**Запуск фронтенда:**

В отдельном терминале (из корневой директории):

```bash
npm run dev
```

Фронтенд будет доступен по адресу `http://localhost:5173` (или другому порту, если 5173 занят).

**Или запуск обоих одновременно:**

```bash
# Терминал 1 - бэкенд
npm run start:backend

# Терминал 2 - фронтенд
npm run start:frontend
```

### Сборка для продакшена

```bash
npm run build
```

Собранные файлы будут находиться в папке `dist`.

### Предпросмотр продакшен сборки

```bash
npm run preview
```

## Запуск тестов

```bash
npm test
```

Запуск тестов с UI:

```bash
npm run test:ui
```

## Структура проекта

```
frontend/
├── src/
│   ├── components/       # Переиспользуемые компоненты
│   │   ├── AppLayout.vue
│   │   ├── Navigation.vue
│   │   ├── SeatGrid.vue
│   │   ├── SeatCanvas.vue
│   │   ├── BookingCard.vue
│   │   ├── PaymentTimer.vue
│   │   ├── ConfirmModal.vue
│   │   └── NotificationContainer.vue
│   ├── views/            # Страницы приложения
│   │   ├── Movies.vue
│   │   ├── MovieDetail.vue
│   │   ├── Cinemas.vue
│   │   ├── CinemaDetail.vue
│   │   ├── Booking.vue
│   │   ├── MyBookings.vue
│   │   ├── Login.vue
│   │   └── Register.vue
│   ├── stores/           # Pinia stores
│   │   ├── auth.ts
│   │   ├── movies.ts
│   │   ├── cinemas.ts
│   │   ├── sessions.ts
│   │   ├── bookings.ts
│   │   └── index.ts
│   ├── composables/      # Композиционные функции
│   │   ├── useDataLoader.ts
│   │   └── useNotifications.ts
│   ├── router/           # Vue Router конфигурация
│   │   └── index.ts
│   ├── utils/            # Утилиты
│   │   ├── api.ts
│   │   ├── validation.ts
│   │   ├── date.ts
│   │   ├── bookings.ts
│   │   ├── data.ts
│   │   ├── errorHandler.ts
│   │   ├── format.ts
│   │   ├── requestController.ts
│   │   ├── sessions.ts
│   │   ├── storeHelpers.ts
│   │   └── text.ts
│   ├── types/            # TypeScript типы
│   │   └── api.ts
│   ├── styles/           # Стили
│   │   ├── variables.css
│   │   └── utilities.css
│   ├── config.ts
│   ├── App.vue
│   └── main.ts
├── vite.config.ts
├── tsconfig.json
└── package.json
```

## Основной функционал

### Авторизация и регистрация

- **Регистрация**: username (минимум 8 символов), password (минимум 8 символов, 1 заглавная буква, 1 цифра)
- **Авторизация**: вход по username и password
- JWT токен сохраняется в localStorage
- После успешной авторизации/регистрации редирект на страницу "Мои билеты"

### Просмотр фильмов и кинотеатров

- Список фильмов с постерами, продолжительностью и рейтингом
- Детальная страница фильма с сеансами, сгруппированными по датам и кинотеатрам
- Список кинотеатров
- Детальная страница кинотеатра с сеансами, сгруппированными по датам и фильмам

### Бронирование билетов

- Выбор мест в зале (прямоугольная сетка)
- Визуальное отображение свободных, занятых и выбранных мест
- Для неавторизованных пользователей - только просмотр, кнопка ведет на страницу входа
- Для авторизованных - возможность бронирования мест

### Управление заказами

- Страница "Мои билеты" доступна только для авторизованных пользователей
- Билеты сгруппированы в категории:
  - **Неоплаченные**: с кнопкой оплаты и таймером
  - **Будущие**: оплаченные билеты на будущие сеансы
  - **Прошедшие**: билеты на прошедшие сеансы
- Автоматическое удаление неоплаченных билетов при истечении времени оплаты

## API

Приложение использует API бэкенда, доступное на `http://localhost:3022`.

Основные эндпоинты:
- `POST /login` - авторизация
- `POST /register` - регистрация
- `GET /movies` - список фильмов
- `GET /movies/:id/sessions` - сеансы фильма
- `GET /cinemas` - список кинотеатров
- `GET /cinemas/:id/sessions` - сеансы кинотеатра
- `GET /movieSessions/:id` - детали сеанса
- `POST /movieSessions/:id/bookings` - бронирование мест
- `GET /me/bookings` - билеты пользователя
- `POST /bookings/:id/payments` - оплата билета
- `GET /settings` - настройки приложения

## Особенности реализации

- Использование промисов вместо try-catch для обработки ошибок
- Обработчики onSuccess/onError/onSettled вынесены наружу
- Избегание глубокой вложенности кода
- Использование объектных маппингов вместо switch-case
- Ранний return для упрощения логики

## Масштабируемость и поддерживаемость архитектуры

### Реализовано

- **Модульная структура**: Четкое разделение на stores, composables, utils, components и views обеспечивает изоляцию функциональности и упрощает навигацию по коду
- **TypeScript**: Строгая типизация повышает надежность кода и упрощает рефакторинг
- **Централизованное управление состоянием**: Pinia stores организованы по доменам (auth, movies, cinemas, sessions, bookings) для предсказуемого управления данными. Stores агностичны - бизнес-логика изолирована от UI и может быть переиспользована в других контекстах
- **Переиспользуемые composables**: `useDataLoader` и `useNotifications` инкапсулируют общую логику загрузки данных и уведомлений
- **Единый API клиент**: Централизованный `apiClient` с interceptors для автоматической обработки авторизации и ошибок
- **Утилиты для переиспользования**: Вынесенные в отдельные модули функции валидации, форматирования, работы с датами и обработки ошибок
- **Контроллер запросов**: `RequestController` для управления отменой запросов и предотвращения race conditions
- **Тестирование**: Настроена инфраструктура тестирования с Vitest для обеспечения качества кода

### Возможные улучшения

- **Автоматическая генерация типов и API клиента**: Использование [orval](https://orval.dev/) для автоматической генерации TypeScript типов и API клиента на основе Swagger документации бэкенда (`http://localhost:3022/api-docs`). Это обеспечит синхронизацию типов с бэкендом и автоматическую генерацию типизированных методов для всех эндпоинтов
- **i18n (интернационализация)**: Добавление поддержки нескольких языков через vue-i18n или аналогичную библиотеку для расширения аудитории
- **Ленивая загрузка маршрутов**: Code splitting для уменьшения начального размера бандла и ускорения загрузки приложения
- **Кэширование данных**: Реализация стратегий кэширования на уровне stores для оптимизации количества запросов к API
- **Виртуализация списков**: Для больших списков фильмов/кинотеатров можно использовать виртуализацию для улучшения производительности
- **Service Workers**: Добавление PWA функциональности для офлайн-режима и улучшения пользовательского опыта
- **Мониторинг и аналитика**: Интеграция систем мониторинга ошибок (Sentry) и аналитики для отслеживания производительности
- **Микросервисная архитектура**: При росте проекта можно разделить бэкенд на отдельные сервисы (auth, bookings, content)
- **Docker контейнеризация**: Упрощение развертывания и масштабирования через контейнеризацию
- **CI/CD пайплайны**: Автоматизация тестирования и деплоя для ускорения разработки

## Тестирование

Тесты написаны для:
- Утилиты валидации форм (`validation.test.ts`)
- Компонент PaymentTimer (таймер оплаты) (`PaymentTimer.test.ts`)
- Store авторизации (`auth.test.ts`)

## Требования

- Node.js 18+
- npm или yarn
- Запущенный бэкенд на `http://localhost:3022` (для работы приложения)

